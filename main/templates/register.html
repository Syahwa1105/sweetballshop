{% extends 'base.html' %}
{% load static %}

{% block meta %}
<title>Register - SweetBall Shop</title>
{% endblock meta %}

{% block content %}
<div class="flex justify-center items-center min-h-[80vh] bg-bg-soft px-4">
  <div class="bg-white shadow-md rounded-xl p-6 w-full max-w-sm">

    <h1 class="text-3xl font-bold text-sweet-pink text-center mb-6">
      Register
    </h1>

    <!-- Tempat muncul pesan AJAX (tetap ada, tapi sekarang dipakai buat state loading aja) -->
    <div id="ajax-message" class="text-center mb-4"></div>

    <form id="registerForm" method="POST" class="space-y-4 form-rounded">
      {% csrf_token %}

      <!-- Username -->
      <div>
        <label class="block text-sm font-semibold text-text-dark mb-1">
          Username
        </label>
        {{ form.username }}
      </div>

      <!-- Password -->
      <div>
        <label class="block text-sm font-semibold text-text-dark mb-1">
          Password
        </label>
        {{ form.password1 }}
        <ul class="mt-2 text-xs text-gray-500 list-disc list-inside leading-snug">
          <li>Minimal 8 karakter</li>
          <li>Tidak boleh mirip dengan data pribadi</li>
          <li>Tidak boleh hanya angka atau kata umum</li>
        </ul>
      </div>

      <!-- Password Confirmation -->
      <div>
        <label class="block text-sm font-semibold text-text-dark mb-1">
          Confirm Password
        </label>
        {{ form.password2 }}
      </div>

      <button type="submit" class="w-full btn-sweet btn-pink">
        Daftar
      </button>
    </form>

    <p class="text-sm text-center mt-4 text-gray-700">
      Already have an account?
      <a href="{% url 'main:login' %}"
         class="text-sweet-pink font-semibold hover:underline">
         Login Here
      </a>
    </p>

  </div>
</div>

<!-- === Script AJAX Register === -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("registerForm");
  const messageBox = document.getElementById("ajax-message");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    messageBox.innerHTML = "<p class='text-gray-500 text-sm'>Memproses pendaftaran...</p>";

    const formData = new FormData(form);
    const response = await fetch("{% url 'main:register' %}", {
      method: "POST",
      headers: {
        "X-Requested-With": "XMLHttpRequest",
      },
      body: formData,
    });

    const data = await response.json();

    if (data.status === "success") {
      showToast(data.message, "success");
      messageBox.innerHTML = `<p class='text-green-600 text-sm font-semibold'>${data.message}</p>`;
      setTimeout(() => {
        window.location.href = "{% url 'main:login' %}";
      }, 1500);
    } else {
      showToast(data.message, "error");
      messageBox.innerHTML = `<p class='text-red-500 text-sm font-semibold'>${data.message}</p>`;
    }
  });
});
</script>
{% endblock content %}
