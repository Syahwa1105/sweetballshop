{% extends "base.html" %}
{% load static %}

{% block meta %}
<title>Login - SweetBall Shop</title>
{% endblock meta %}

{% block content %}
<div class="flex justify-center items-center min-h-[80vh] bg-bg-soft px-4">
  <div class="bg-white shadow-md rounded-xl p-6 w-full max-w-sm">
    <h1 class="text-3xl font-bold text-sweet-pink text-center mb-6">
      Login
    </h1>

    <form id="loginForm" method="POST" class="space-y-4 form-rounded">
      {% csrf_token %}
      <div>
        <label class="block text-sm font-semibold text-text-dark mb-1">Username</label>
        <input type="text" name="username" class="border p-2 w-full rounded" required>
      </div>

      <div>
        <label class="block text-sm font-semibold text-text-dark mb-1">Password</label>
        <input type="password" name="password" class="border p-2 w-full rounded" required>
      </div>

      <button type="submit" class="w-full btn-sweet btn-pink">Login</button>
    </form>

    <p class="text-sm text-center mt-4 text-gray-700">
      Donâ€™t have an account yet?
      <a href="{% url 'main:register' %}"
         class="text-sweet-pink font-semibold hover:underline">
         Register Now
      </a>
    </p>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("loginForm");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const response = await fetch("{% url 'main:login' %}", {
      method: "POST",
      headers: {
        "X-Requested-With": "XMLHttpRequest",
        "X-CSRFToken": "{{ csrf_token }}",
      },
      body: formData,
    });

    const result = await response.json();

    if (result.status === "success") {
      showToast("Login berhasil! ðŸŽ‰", "success");
      setTimeout(() => {
        window.location.href = "{% url 'main:show_main' %}";
      }, 1200);
    } else {
      showToast(result.message || "Username atau password salah!", "error");
    }
  });
});
</script>
{% endblock content %}
